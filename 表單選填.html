<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>學生醫院志願填寫</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  label { display: block; margin-top: 10px; }
  select, input { width: 300px; padding: 5px; margin-top: 5px; }
  .section { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; }
  button { padding: 10px 20px; margin-top: 10px; }
  #message { margin-top: 10px; color: green; }
</style>
</head>
<body>

<h2>學生醫院志願填寫表單</h2>

<form id="volunteerForm">
  <div class="section">
    <label>姓名: <input type="text" name="name" required></label>
    <label>學號: <input type="text" name="studentId" required></label>
    <label>手機號: <input type="text" name="phone" required></label>
    <label>學制:
      <select name="program" required>
        <option value="">請選擇學制</option>
        <option value="日二技">日二技</option>
        <option value="進四技">進四技</option>
        <option value="日四技">日四技</option>
      </select>
    </label>
    <label>是否申請醫院獎學金:
      <select name="scholarship" required>
        <option value="">請選擇</option>
        <option value="是">是</option>
        <option value="否">否</option>
      </select>
    </label>
  </div>

  <div class="section">
    <h3>志願填寫</h3>
    <label>志願一醫院:
      <select name="hospital1" id="hospital1" required>
        <option value="">請選擇醫院</option>
      </select>
    </label>
    <label>志願一單位:
      <select name="unit1" id="unit1" required>
        <option value="">請先選醫院</option>
      </select>
    </label>

    <label>志願二醫院:
      <select name="hospital2" id="hospital2" required>
        <option value="">請選擇醫院</option>
      </select>
    </label>
    <label>志願二單位:
      <select name="unit2" id="unit2" required>
        <option value="">請先選醫院</option>
      </select>
    </label>
  </div>

  <button type="submit">送出表單</button>
</form>

<div id="message"></div>

<hr>
<h3>工作人員專用下載區</h3>
<button id="downloadBtn">下載所有學生資料 Excel</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
const hospitals = {
  "醫院A": ["單位A1", "單位A2", "單位A3"],
  "醫院B": ["單位B1", "單位B2"],
  "醫院C": ["單位C1", "單位C2", "單位C3", "單位C4"],
  "醫院D": ["單位D1"]
};

// 暫存學生資料
let allData = [];

// 設定工作人員密碼
const STAFF_PASSWORD = "staff123"; // 可以自行修改

// 生成醫院選項
function populateHospitals() {
  const hospitalSelects = [document.getElementById('hospital1'), document.getElementById('hospital2')];
  hospitalSelects.forEach(select => {
    for (let h in hospitals) {
      let option = document.createElement('option');
      option.value = h;
      option.textContent = h;
      select.appendChild(option);
    }
  });
}

// 根據醫院更新單位選項
function updateUnits(hospitalSelectId, unitSelectId) {
  const hospitalSelect = document.getElementById(hospitalSelectId);
  const unitSelect = document.getElementById(unitSelectId);

  function setUnits() {
    unitSelect.innerHTML = '';
    const selectedHospital = hospitalSelect.value;
    if (!selectedHospital) {
      let option = document.createElement('option');
      option.textContent = '請先選醫院';
      option.value = '';
      unitSelect.appendChild(option);
      return;
    }
    hospitals[selectedHospital].forEach(unit => {
      let option = document.createElement('option');
      option.value = unit;
      option.textContent = unit;
      unitSelect.appendChild(option);
    });
  }

  hospitalSelect.addEventListener('change', setUnits);
  setUnits(); // 頁面載入時初始化單位
}

// 表單送出
document.getElementById('volunteerForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const formData = new FormData(this);
  const data = {};
  formData.forEach((value, key) => {
    data[key] = value;
  });
  allData.push(data);
  document.getElementById('message').textContent = `資料已送出，目前累計 ${allData.length} 筆`;
  this.reset();
  // 重置單位下拉
  document.getElementById('unit1').innerHTML = '<option value="">請先選醫院</option>';
  document.getElementById('unit2').innerHTML = '<option value="">請先選醫院</option>';
});

// 工作人員下載 Excel（需密碼）
document.getElementById('downloadBtn').addEventListener('click', function() {
  if (allData.length === 0) {
    alert("目前沒有資料可以下載！");
    return;
  }
  const password = prompt("請輸入工作人員密碼下載 Excel：");
  if (password !== STAFF_PASSWORD) {
    alert("密碼錯誤，無法下載！");
    return;
  }
  const ws = XLSX.utils.json_to_sheet(allData);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "志願資料");
  XLSX.writeFile(wb, "所有學生志願資料.xlsx");
});

populateHospitals();
updateUnits('hospital1', 'unit1');
updateUnits('hospital2', 'unit2');
</script>

</body>
</html>
